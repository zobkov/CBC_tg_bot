# Бот КБК для отбора кандидатов

Telegram бот для автоматизации процесса отбора кандидатов в команду КБК 2026.

## Функционал

### Реализованные возможности:
1. **Приветственный диалог** - знакомство с командой КБК
2. **Главное меню** - отображение текущего этапа отбора и статуса заявки
3. **Первый этап отбора** - заполнение анкеты кандидата со всеми необходимыми полями:
   - ФИО
   - Учебное заведение
   - Курс (1-6)
   - Телефон
   - Email
   - Telegram username (автоматически)
   - Откуда узнали о КБК
   - Выбор отдела и должности
   - Описание опыта
   - Мотивация
   - Загрузка резюме

4. **База данных PostgreSQL** для хранения:
   - Данных пользователей Telegram
   - Заявок и их статусов
   - Информации из анкет

5. **Экспорт данных**:
   - Автоматическое сохранение в CSV файлы для бекапа
   - Интеграция с Google Sheets (опционально)
   - Загрузка резюме на Google Drive (опционально)

6. **Система статусов заявок**:
   - Не подана
   - Этап 1 (подана)
   - Этап 2 (на рассмотрении)
   - Этап 3 (финальный)
   - Отклонена
   - Одобрена

## Установка и настройка

### 1. Клонирование репозитория
```bash
git clone <repository_url>
cd cbc_crew_selection_bot
```

### 2. Установка зависимостей
```bash
# Убедитесь, что у вас установлен Python 3.12+
pip install poetry

# Установка зависимостей
poetry install
```

### 3. Настройка базы данных PostgreSQL

#### Локально:
```bash
# Установите PostgreSQL
# Создайте базу данных и пользователя
psql -U postgres
CREATE DATABASE vol_bot_db;
CREATE USER vol_bot WITH PASSWORD 'vol_bot_pass';
GRANT ALL PRIVILEGES ON DATABASE vol_bot_db TO vol_bot;
```

#### С помощью Docker:
```bash
cp docker-compose.example docker-compose.yml
# Отредактируйте docker-compose.yml при необходимости
docker-compose up -d postgres
```

### 4. Настройка переменных окружения

Создайте файл `.env` и заполните его:
```env
# Обязательные настройки
BOT_TOKEN=your_telegram_bot_token_here
DB_USER=vol_bot
DB_PASS=vol_bot_pass
DB_NAME=vol_bot_db
DB_HOST=localhost  # или IP адрес сервера БД
DB_PORT=5432

# Опциональные настройки для Google Services
GOOGLE_CREDENTIALS_PATH=config/google_credentials.json
GOOGLE_SPREADSHEET_ID=your_spreadsheet_id_here
GOOGLE_DRIVE_FOLDER_ID=your_drive_folder_id_here
```

### 5. Применение миграций базы данных

```bash
# Выполните SQL миграции в порядке:
psql -U vol_bot -d vol_bot_db -f migrations/000_create_users_table.sql
psql -U vol_bot -d vol_bot_db -f migrations/001_create_applications_table.sql
```

### 6. Настройка Google Services (опционально)

Для интеграции с Google Sheets и Google Drive:

1. Создайте проект в [Google Cloud Console](https://console.cloud.google.com/)
2. Включите Google Sheets API и Google Drive API
3. Создайте сервисный аккаунт и скачайте JSON файл с ключами
4. Поместите файл в `config/google_credentials.json`
5. Создайте Google Таблицу и папку на Google Drive
6. Дайте доступ сервисному аккаунту к таблице и папке
7. Укажите ID таблицы и папки в `.env`

### 7. Настройка конфигурации отбора

Отредактируйте `config/selection_config.json`:
- Даты этапов отбора
- Списки отделов и должностей
- Контакты поддержки

## Запуск

```bash
# Активация виртуального окружения (если используете poetry)
poetry shell

# Запуск бота
python main.py
```

## Структура проекта

```
├── app/
│   ├── bot/
│   │   ├── dialogs/          # Диалоги aiogram-dialog
│   │   │   ├── start/        # Приветственный диалог
│   │   │   ├── main_menu/    # Главное меню
│   │   │   └── first_stage/  # Первый этап отбора
│   │   ├── enums/            # Перечисления (статусы, роли)
│   │   ├── handlers/         # Обработчики команд
│   │   ├── middlewares/      # Middleware для БД и др.
│   │   └── states/           # Состояния FSM
│   ├── infrastructure/
│   │   └── database/         # Модели и работа с БД
│   ├── services/             # Сервисы (Google, логирование)
│   └── storage/              # Локальное хранилище файлов
├── config/                   # Конфигурационные файлы
├── migrations/               # SQL миграции
└── main.py                   # Точка входа
```

## Использование

1. **Запуск бота**: `/start`
2. **Главное меню**: Информация о текущем этапе и статусе заявки
3. **Подача заявки**: Пошаговое заполнение анкеты
4. **Поддержка**: Контакты для связи

## Администрирование

### Мониторинг заявок
- Данные сохраняются в PostgreSQL
- CSV бекапы в `app/storage/backups/`
- Google Sheets (если настроено)

### Управление этапами
Измените даты в `config/selection_config.json` и перезапустите бота.

### Логи
Логи сохраняются в `app/logs/` с ротацией по дням.

## Возможные проблемы и решения

### Ошибки подключения к БД
- Проверьте настройки в `.env`
- Убедитесь, что PostgreSQL запущен
- Проверьте права доступа пользователя БД

### Проблемы с Google Services
- Проверьте путь к файлу учетных данных
- Убедитесь, что API включены в Google Cloud Console
- Проверьте права доступа сервисного аккаунта

### Ошибки при загрузке файлов
- Проверьте права на запись в `app/storage/`
- Убедитесь, что директории созданы

## Развитие

### Планируемые функции:
- Второй и третий этапы отбора
- Административная панель
- Уведомления о смене статуса заявки
- Массовая рассылка
- Аналитика и отчеты

### Добавление новых этапов:
1. Добавьте состояния в `app/bot/states/`
2. Создайте диалоги в `app/bot/dialogs/`
3. Обновите `config/selection_config.json`
4. Добавьте миграции БД при необходимости

## Поддержка

При возникновении проблем:
1. Проверьте логи в `app/logs/`
2. Убедитесь в правильности конфигурации
3. Проверьте статус всех сервисов (БД, бот)

## Лицензия

[Укажите лицензию проекта]
