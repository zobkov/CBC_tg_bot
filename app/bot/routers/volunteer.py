"""
–†–æ—É—Ç–µ—Ä –¥–ª—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤
"""
import logging
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message

from app.bot.filters.rbac import HasRole
from app.bot.filters.legacy_intents import create_rbac_filter_with_legacy_exclusion
from app.enums.roles import Role

logger = logging.getLogger(__name__)

router = Router(name="volunteer")

# –§–∏–ª—å—Ç—Ä –¥–ª—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ —Ä–æ–ª–µ–π –≤—ã—à–µ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º legacy –∏–Ω—Ç–µ–Ω—Ç–æ–≤
volunteer_filter = create_rbac_filter_with_legacy_exclusion(Role.VOLUNTEER, Role.STAFF, Role.ADMIN)
router.message.filter(volunteer_filter)
router.callback_query.filter(volunteer_filter)


@router.message(Command("volunteer_help"))
async def volunteer_help_command(message: Message):
    """–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤"""
    await message.answer(
        "ü§ù <b>–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –ö–ë–ö</b>\n\n"
        "–í–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:\n"
        "‚Ä¢ –ü–æ–º–æ—â—å –Ω–æ–≤—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º\n"
        "‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n"
        "‚Ä¢ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏\n\n"
        "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
        "‚Ä¢ /volunteer_stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
        "‚Ä¢ /faq - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
        "‚Ä¢ /escalate - –ü–µ—Ä–µ–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º\n\n"
        "üìã –ü–æ–º–Ω–∏—Ç–µ: –≤—Å–µ–≥–¥–∞ –±—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ —Ç–µ—Ä–ø–µ–ª–∏–≤—ã!"
    )


@router.message(Command("volunteer_stats"))
async def volunteer_stats_command(message: Message, db=None):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤"""
    if not db:
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
        return
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        # TODO: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        await message.answer(
            "üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</b>\n\n"
            "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...\n\n"
            "–ë—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:\n"
            "‚Ä¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
            "‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫\n"
            "‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ –¥–µ–Ω—å\n"
            "‚Ä¢ –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã"
        )
    except Exception as e:
        logger.error(f"Error getting stats: {e}")
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")


@router.message(Command("faq"))
async def faq_command(message: Message):
    """–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –ø–æ–º–æ—â–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º"""
    await message.answer(
        "‚ùì <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</b>\n\n"
        "<b>1. –ö–∞–∫ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É?</b>\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /apply –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.\n\n"
        "<b>2. –ö–æ–≥–¥–∞ –±—É–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?</b>\n"
        "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.\n\n"
        "<b>3. –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?</b>\n"
        "–î–æ –¥–µ–¥–ª–∞–π–Ω–∞ –∑–∞—è–≤–∫—É –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.\n\n"
        "<b>4. –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç?</b>\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ /start –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.\n\n"
        "<b>5. –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏?</b>\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /support –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–æ–º–∞–Ω–¥–æ–π."
    )


@router.message(Command("escalate"))
async def escalate_command(message: Message):
    """–ü–µ—Ä–µ–¥–∞—á–∞ –≤–æ–ø—Ä–æ—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"""
    await message.answer(
        "üîÑ <b>–ü–µ—Ä–µ–¥–∞—á–∞ –≤–æ–ø—Ä–æ—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</b>\n\n"
        "–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤,\n"
        "–ø–µ—Ä–µ–∞–¥—Ä–µ—Å—É–π—Ç–µ –µ–≥–æ –∫ –∫–æ–º–∞–Ω–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\n"
        "üìù –£–∫–∞–∂–∏—Ç–µ:\n"
        "‚Ä¢ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n"
        "‚Ä¢ –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã\n"
        "‚Ä¢ –ß—Ç–æ —É–∂–µ –±—ã–ª–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ\n\n"
        "‚ö° –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ –Ω–æ–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏."
    )