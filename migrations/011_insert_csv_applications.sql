-- –í—Å—Ç–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –∏–∑ CSV —Ñ–∞–π–ª–∞
-- –§–∞–π–ª: 011_insert_csv_applications.sql

-- –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É users (–µ—Å–ª–∏ –∏—Ö —Ç–∞–º –µ—â–µ –Ω–µ—Ç)
INSERT INTO users (user_id, language, is_alive, is_blocked, submission_status)
VALUES 
  -- –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ Telegram username, –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ ID
  -- –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ Telegram user_id
  (1001, 'ru', true, false, 'submitted'), -- @bugassha
  (1002, 'ru', true, false, 'not_submitted') -- @hlorsson
ON CONFLICT (user_id) DO NOTHING;

-- –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É applications
INSERT INTO applications (
    user_id,
    full_name,
    university,
    phone,
    email,
    telegram_username,
    how_found_kbk,
    previous_department,
    department_1,
    subdepartment_1,
    position_1,
    department_2,
    subdepartment_2,
    position_2,
    department_3,
    subdepartment_3,
    position_3,
    experience,
    motivation,
    created,
    updated
) VALUES 
  (
    865431031, -- user_id –¥–ª—è @bugassha
    '–ë—É–≥–∞–µ–≤–∞ –ö—Å–µ–Ω–∏—è –î–µ–Ω–∏—Å–æ–≤–Ω–∞',
    '–í–®–ú –°–ü–±–ì–£, 1 –∫—É—Ä—Å',
    '89029927576',
    'st143890@student.spbu.ru',
    '@bugassha',
    NULL, -- –ö–∞–∫ –Ω–∞—à–ª–∏ - –ø—É—Å—Ç–æ –≤ CSV
    NULL, -- –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–¥–µ–ª - –ø—É—Å—Ç–æ –≤ CSV
    '–û—Ç–¥–µ–ª SMM&PR',
    '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∫–∏—Ç–∞–π—Å–∫–æ–º',
    '–ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä',
    '–û—Ç–¥–µ–ª SMM&PR',
    '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∫–∏—Ç–∞–π—Å–∫–æ–º',
    '–†–∏–ª—Å–º–µ–π–∫–µ—Ä',
    '–û—Ç–¥–µ–ª –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ò–¢',
    NULL, -- –ü–æ–¥-–æ—Ç–¥–µ–ª 3 –ø—É—Å—Ç–æ–π
    '–õ–æ–≥–∏—Å—Ç',
    '–ö–∞—Å–∞–µ–º–æ –º–æ–µ–≥–æ –æ–ø—ã—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∞ (
–û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –æ–ø—ã—Ç –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç—Å—Ç–µ—Ç–∏—á–Ω—ã—Ö –≤–∏–¥–µ–æ, –∞ —Ç–∞–∫–∂–µ —Ä–∏–ª—Å. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, —è —Å–∞–º–∞ –≤–µ–¥—É –ª–∏—á–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –≤ –∏–Ω—Å—Ç–∞–≥—Ä–∞–º–º–µ, —Å—Ç–∞—Ä–∞—é—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –≤–∏–∑—É–∞–ª, –ø–æ—Ä–æ–π –ø–∏—à—É –ø–æ—Å—Ç—ã, –∞ —Ç–∞–∫–∂–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞—é –∫—Ä–∞—Å–∏–≤—ã–µ (–ø–æ –º–Ω–µ–Ω–∏—é –º–Ω–æ–≥–∏—Ö –º–æ–∏—Ö –¥—Ä—É–∑–µ–π –∏ –∑–Ω–∞–∫–æ–º—ã—Ö) —Å—Ç–æ—Ä–∏—Å
–° –¥–µ—Ç—Å—Ç–≤–∞ —É–≤–ª–µ–∫–∞—é—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–∏–¥–µ–æ. –û—á–µ–Ω—å –ª—é–±–ª—é —Ç–≤–æ—Ä–∏—Ç—å –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç! –ë—ã–ª–∞ –±—ã –±–µ–∑—É–º–Ω–æ —Ä–∞–¥–∞ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ö–ë–ö
–ò–∑ –æ–ø—ã—Ç–∞ –≤ —Å—ä–µ–º–∫–µ —Ä–∏–ª—Å–æ–≤, —è —Å–Ω–∏–º–∞–ª–∞ –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞ —Ä–∏–ª—Å—ã –¥–ª—è –ø–æ–¥—Ä—É–∂–µ–∫, –∞ —Ç–∞–∫–∂–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–º–æ–≥–∞–ª–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≤ —à–∫–æ–ª–µ.
–ü–æ –ø–æ–≤–æ–¥—É –æ—Ç–¥–µ–ª–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏, —è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞, –∞–∫–∫—É—Ä–∞—Ç–Ω–∞ –∏ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–∞, –∑–∞ —Å—á–µ—Ç —á–µ–≥–æ —Å—á–∏—Ç–∞—é, —á—Ç–æ —Å–ø—Ä–∞–≤–∏–ª–∞—Å—å –±—ã –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.
–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –∑–∞—Ö–æ—á–µ—Ç—Å—è –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Ä–∞–±–æ—Ç—ã –≤ –∏–Ω—Å—Ç–∞–≥—Ä–∞–º–º–µ, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–∑—É–∞–ª, —Ç–æ –æ—Å—Ç–∞–≤–ª—é —Å–≤–æ–π –Ω–∏–∫) @bugassha',
    '–Ø –æ—á–µ–Ω—å —Ö–æ—á—É –±—ã—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ –ö–ë–ö –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–±—è
–ù–∞—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∫–∏–ª–ª –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∏–ª—Å–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∞, –¥–ª—è –º–µ–Ω—è —ç—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —Å–∞–º–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Å—å —ç—Ç–æ–π —Å—Ñ–µ—Ä–æ–π. –ö—Å—Ç–∞—Ç–∏ –≥–æ–≤–æ—Ä—è, —è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∞–º–æ–∫—Ä–∏—Ç–∏—á–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, —Ç–∞–∫ —á—Ç–æ –≤—Å–µ –≤—Å–µ–≥–¥–∞ –¥–æ–≤–æ–∂—É –¥–æ –∏–¥–µ–∞–ª–∞. –ï—Å–ª–∏ –º–Ω–µ —Å–∫–∞–∂—É—Ç –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å-—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –¥–æ–≤–µ–¥—É —Ä–∞–±–æ—Ç—É –¥–æ —Å–∞–º–æ–π –Ω–∞—Å—Ç–æ—è—â–µ–π ¬´–∫–æ–Ω—Ñ–µ—Ç–∫–∏¬ª
–î–æ–≤–æ–ª—å–Ω–æ-—Ç–∞–∫–∏ –Ω–µ–æ–±—ã—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –Ω–æ –º–Ω–µ –æ—á–µ–Ω—å –Ω—Ä–∞–≤–∏—Ç—Å—è, —á—Ç–æ –æ–Ω
–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π, —Ö–æ—á—É –Ω–∞–±—Ä–∞—Ç—å—Å—è –æ–ø—ã—Ç–∞ –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–æ–π —Å—Ä–µ–¥–µ.
 –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø–æ–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Ä–µ–±—è—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–≤–Ω–æ –≤ —Å—Ñ–µ—Ä–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–∫—Ä–µ–∞—Ç–æ—Ä—Å—Ç–≤–∞, –∞ —Ç–∞–∫–∂–µ —Å —Ç–µ–º–∏, –∫—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç. –ò —è –û–ß–ï–ù–¨ —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç—ã –æ—Ç —Ä–µ–±—è—Ç, –∫—Ç–æ —É–∂–µ –ø—Ä—è–º –Ω–∞ –æ–ø—ã—Ç–µ, —è –¥—É–º–∞—é —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç-–≤–µ—â–∏ –ø–æ —Ç–∏–ø—É —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∞ –∏ —Ä–∏–ª—Å–æ–≤ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∞ —ç—Ç–æ –∫—Ä–∞–π–Ω–µ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –±—É—Å—Ç–∞ –Ω–∞–≤—ã–∫–æ–≤ –≤ —Ç–æ–π –∏–ª–∏ –∏–Ω–æ–π —Å—Ñ–µ—Ä–µüôèüèª',
    NOW(),
    NOW()
  ),
  (
    1611830001, -- user_id –¥–ª—è @hlorsson
    '–ú–µ–ª—å–Ω–æ–≤ –¢–∏–º—É—Ä –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
    '–°–ø–ë–ì–£–ü–¢–î, –ò–ì–î (–ò–Ω—Å—Ç–∏—Ç—É—Ç –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞), 4 –∫—É—Ä—Å, –≤—ã–ø—É—Å–∫ 2028',
    '79627365678',
    'hlorsson@gmail.com',
    '@hlorsson',
    NULL, -- –ö–∞–∫ –Ω–∞—à–ª–∏ - –ø—É—Å—Ç–æ –≤ CSV
    NULL, -- –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–¥–µ–ª - –ø—É—Å—Ç–æ –≤ CSV
    '–û—Ç–¥–µ–ª –¥–∏–∑–∞–π–Ω–∞',
    NULL, -- –ü–æ–¥-–æ—Ç–¥–µ–ª 1 –ø—É—Å—Ç–æ–π
    '–ò–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä',
    NULL, -- –û—Ç–¥–µ–ª 2 –ø—É—Å—Ç–æ–π
    NULL, -- –ü–æ–¥-–æ—Ç–¥–µ–ª 2 –ø—É—Å—Ç–æ–π
    NULL, -- –ü–æ–∑–∏—Ü–∏—è 2 –ø—É—Å—Ç–∞—è
    NULL, -- –û—Ç–¥–µ–ª 3 –ø—É—Å—Ç–æ–π
    NULL, -- –ü–æ–¥-–æ—Ç–¥–µ–ª 3 –ø—É—Å—Ç–æ–π
    NULL, -- –ü–æ–∑–∏—Ü–∏—è 3 –ø—É—Å—Ç–∞—è
    NULL, -- –û–ø—ã—Ç –ø—É—Å—Ç–æ–π
    NULL, -- –ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—É—Å—Ç–∞—è
    NOW(),
    NOW()
  )
ON CONFLICT (user_id) DO UPDATE SET
    full_name = EXCLUDED.full_name,
    university = EXCLUDED.university,
    phone = EXCLUDED.phone,
    email = EXCLUDED.email,
    telegram_username = EXCLUDED.telegram_username,
    how_found_kbk = EXCLUDED.how_found_kbk,
    previous_department = EXCLUDED.previous_department,
    department_1 = EXCLUDED.department_1,
    subdepartment_1 = EXCLUDED.subdepartment_1,
    position_1 = EXCLUDED.position_1,
    department_2 = EXCLUDED.department_2,
    subdepartment_2 = EXCLUDED.subdepartment_2,
    position_2 = EXCLUDED.position_2,
    department_3 = EXCLUDED.department_3,
    subdepartment_3 = EXCLUDED.subdepartment_3,
    position_3 = EXCLUDED.position_3,
    experience = EXCLUDED.experience,
    motivation = EXCLUDED.motivation,
    updated = NOW();

-- –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É evaluated_applications
-- –ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–æ–Ω–æ–∫ "–û–¥–æ–±—Ä–µ–Ω 1", "–û–¥–æ–±—Ä–µ–Ω 2", "–û–¥–æ–±—Ä–µ–Ω 3" –∏–∑ CSV
INSERT INTO evaluated_applications (
    user_id,
    accepted_1,
    accepted_2, 
    accepted_3,
    created,
    updated
) VALUES 
  (
    865431031, -- user_id –¥–ª—è @bugassha
    true,  -- –û–¥–æ–±—Ä–µ–Ω 1: "–î–∞"
    true,  -- –û–¥–æ–±—Ä–µ–Ω 2: "–î–∞"  
    true,  -- –û–¥–æ–±—Ä–µ–Ω 3: "–î–∞"
    NOW(),
    NOW()
  ),
  (
    1611830001, -- user_id –¥–ª—è @hlorsson
    false, -- –û–¥–æ–±—Ä–µ–Ω 1: –ø—É—Å—Ç–æ (—Å—á–∏—Ç–∞–µ–º –∫–∞–∫ false)
    false, -- –û–¥–æ–±—Ä–µ–Ω 2: –ø—É—Å—Ç–æ (—Å—á–∏—Ç–∞–µ–º –∫–∞–∫ false)
    false, -- –û–¥–æ–±—Ä–µ–Ω 3: –ø—É—Å—Ç–æ (—Å—á–∏—Ç–∞–µ–º –∫–∞–∫ false)
    NOW(),
    NOW()
  )
ON CONFLICT (user_id) DO UPDATE SET
    accepted_1 = EXCLUDED.accepted_1,
    accepted_2 = EXCLUDED.accepted_2,
    accepted_3 = EXCLUDED.accepted_3,
    updated = NOW();

-- –û–±–Ω–æ–≤–ª—è–µ–º submission_status –≤ —Ç–∞–±–ª–∏—Ü–µ users –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏
UPDATE users 
SET submission_status = (
    CASE 
        WHEN applications.status = 'submitted' THEN 'submitted'
        ELSE 'not_submitted'
    END
),
updated = NOW()
FROM applications 
WHERE users.user_id = applications.user_id;